<html lang="en">


<!-- Mirrored from thecopenhagenbook.com/webauthn by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content="custom" />
  <title>WebAuthn</title>
  <meta name="description" content="A basic guideline on implementing auth for the web." />

  <meta name="twitter:card" content="summary" />
  
  <meta name="twitter:site" content="@pilcrowonpaper" />
  
  <meta name="twitter:title" content="WebAuthn" />
  <meta name="twitter:description" content="A basic guideline on implementing auth for the web." />

  <meta property="og:site_name" content="The Copenhagen Book" />
  <meta property="og:title" content="WebAuthn" />
  <meta property="og:url" content="webauthn.html" />
  <meta property="og:description" content="A basic guideline on implementing auth for the web." />
  

  

  
  <link rel="stylesheet" href="javascript.css" />
  
  <link rel="stylesheet" href="json.css" />
  
  <link rel="stylesheet" href="main.css" />
  
  <link rel="stylesheet" href="markdown.css" />
  
  <link rel="stylesheet" href="typescript.css" />
  
</head>

<body>
  <div id="mobile-top">
    <div id="mobile-top-container">
      <header id="mobile-header">
        
        <a href="index.html" id="mobile-header-title">The Copenhagen Book</a>
        
        <button id="toggle-mobile-menu-button" class="h-8 w-8 rounded p-2 lg:hidden" aria-label="Toggle menu">
          <svg id="toggle-mobile-menu-button-menu-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 17 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
          <svg id="toggle-mobile-menu-button-close-icon" class="hidden" aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6">
            </path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
        </button>
      </header>
      <nav id="mobile-menu-nav" class="hidden">
        
        <section>
          <h2 class="nav-section-title">Guides</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="sessions.html" class="nav-section-link">Sessions</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-authentication.html" class="nav-section-link">Password authentication</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="email-verification.html" class="nav-section-link">Email verification</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-reset.html" class="nav-section-link">Password reset</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="random-values.html" class="nav-section-link">Generating random values</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="oauth.html" class="nav-section-link">OAuth</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="webauthn.html" class="current-nav-section-link">WebAuthn</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Cryptography</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Links</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
              
            </li>
            
          </ul>
        </section>
        
      </nav>
    </div>
  </div>
  <div id="content">
    <div id="content-container">
      <aside id="sidebar">
        
        <a href="index.html" id="sidebar-title">The Copenhagen Book</a>
        
        <nav id="sidebar-nav">
          
          <section>
            <h2 class="nav-section-title">Guides</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="sessions.html" class="nav-section-link">Sessions</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-authentication.html" class="nav-section-link">Password authentication</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="email-verification.html" class="nav-section-link">Email verification</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-reset.html" class="nav-section-link">Password reset</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="random-values.html" class="nav-section-link">Generating random values</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="oauth.html" class="nav-section-link">OAuth</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="webauthn.html" class="current-nav-section-link">WebAuthn</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Cryptography</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Links</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
                
              </li>
              
            </ul>
          </section>
          
        </nav>
      </aside>
      <main><h1 id="webauthn">WebAuthn</h1>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#vocabulary">Vocabulary</a></li>
<li><a href="#registration">Registration</a></li>
<li><a href="#authentication">Authentication</a></li>
</ul>
<h2 id="overview">Overview</h2>
<p>The <a href="https://www.w3.org/TR/webauthn-2/">Web Authentication (WebAuthn) standard</a> allow users to authenticate with their device, either with a PIN code or biometrics. The private key is stored in the user's device, while the public key is stored in your application. Applications can authenticate users by verifying signatures. Since credentials are bounded to the user's device (or devices) and brute-forcing is impossible, a potential attacker needs physical access to a device.</p>
<p>WebAuthn are usually used in 2 ways - with passkeys or security tokens. While they don't have a strict definition, passkeys usually refer to credentials that can replace passwords and stored in the authenticator (resident keys). Security tokens, on the other hand, are meant to be used as a second factor, after authenticating with a password. Credentials for 2FA are usually encrypted and stored in the relying party's server. In both cases, they are a more secure alternatives to existing methods.</p>
<p>Using WebAuthn, applications can also verify the device with the manufacturer. This requires attestation and is not covered in this page.</p>
<h2 id="vocabulary">Vocabulary</h2>
<ul>
<li>Relying party: Your application.</li>
<li>Authenticator: The device that holds the credential.</li>
<li>Challenge: A randomly generated, single-use <a href="server-side-tokens.html">token</a> to prevent replay attacks. The recommended minimum entropy is 16 bytes.</li>
<li>User presence: User has access to the device.</li>
<li>User verification: User has verified their identity via a pin-code or biometrics.</li>
<li>Resident keys, discoverable credentials: Credentials stored in stored in authenticators (user devices and security tokens). Non-resident keys are encrypted and stored in relying party servers (your database).</li>
</ul>
<h2 id="registration">Registration</h2>
<p>During the registration step, the authenticator creates a new credential and returns its public key.</p>
<p>In the client, get a new challenge from the server and create a new credential with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Authentication_API">Web Authentication API</a>. This will prompt the user to authenticate with their device. Browsers such as Safari will only allow you to call this method if it was initiated by a user interaction (button click).</p>
<pre class="codeblock"><code class="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">attestation</span><span class="o">:</span> <span class="s2">&#34;none&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">rp</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;My app&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">user</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">id</span>: <span class="kt">crypto.getRandomValues</span><span class="p">(</span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="mi">32</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">			<span class="nx">name</span>: <span class="kt">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">displayName</span>: <span class="kt">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="nx">pubKeyCredParams</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="kr">type</span><span class="o">:</span> <span class="s2">&#34;public-key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// ECDSA with SHA-256
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="nx">alg</span><span class="o">:</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">],</span>
</span></span><span class="line"><span class="cl">		<span class="nx">challenge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">authenticatorSelection</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// See note below.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nx">userVerification</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">residentKey</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">requireResidentKey</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// list of existing credentials
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">excludeCredentials</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">id</span>: <span class="kt">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="kr">type</span><span class="o">:</span> <span class="s2">&#34;public-key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">credential</span> <span class="k">instanceof</span> <span class="nx">PublicKeyCredential</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;Failed to create credential&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">credential</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">response</span> <span class="k">instanceof</span> <span class="nx">AuthenticatorAttestationResponse</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;Unexpected&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">clientDataJSON</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clientDataJSON</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">attestationObject</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">attestationObject</span><span class="p">;</span>
</span></span></code class=%s></pre><ul>
<li><code>rp.name</code>: Your application's name.</li>
<li><code>user.id</code>: Random user ID for the authenticator. This can be different from the actual user ID your application uses.</li>
<li><code>user.name</code>: A human-friendly user identifier (username, email).</li>
<li><code>user.displayName</code>: A human-friendly display name (does not need to be unique).</li>
<li><code>excludeCredentials</code>: A list of the user's credentials to avoid duplicate credentials.</li>
</ul>
<p>The algorithm ID is from the <a href="https://www.iana.org/assignments/cose/cose.xhtml">IANA COSE Algorithms registry</a>. ECDSA with SHA-256 (ES256) is recommended as it is widely supported. You can also pass <code>-257</code> for RSASSA-PKCS1-v1.5 (RS256) to support a wider range of devices but devices that only support it are rare.</p>
<p>For most cases, <code>attestation</code> should be set to <code>&quot;none&quot;</code>. We don't need to verify the authenticity of the authenticator and not all authenticators support it.</p>
<p>For passkeys, ensure the public key is a resident key and requires user verification.</p>
<pre class="codeblock"><code class="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">authenticatorSelection</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">userVerification</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">residentKey</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">requireResidentKey</span>: <span class="kt">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code class=%s></pre><p>For security tokens, we can skip user verification and the credential doesn't need to be a resident key. We can limit the authenticator to security tokens by setting <code>authenticatorAttachment</code> to <code>cross-platform</code> as well.</p>
<pre class="codeblock"><code class="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">authenticatorSelection</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">userVerification</span><span class="o">:</span> <span class="s2">&#34;discouraged&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">residentKey</span><span class="o">:</span> <span class="s2">&#34;discouraged&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">requireResidentKey</span>: <span class="kt">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="nx">authenticatorAttachment</span><span class="o">:</span> <span class="s2">&#34;cross-platform&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="p">},</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code class=%s></pre><p>The client data JSON and authenticator data are sent to the server for verification. A simple way to send binary data is by encoding it with base64. Another option is use schemes like CBOR that encode JSON-like data into binary.</p>
<p>The first step is to parse the attestation object, which is encoded with CBOR. This includes the attestation statement and authenticator data. You can use the attestation statement to verify the user's device if you required it. If you've set it to <code>&quot;none&quot;</code> in the client, verify that the statement format is <code>none</code>.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">attestationObject</span> <span class="nx">AttestationObject</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Parse attestation object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">attestationObject</span><span class="p">.</span><span class="nx">Fmt</span> <span class="o">!=</span> <span class="s">&#34;none&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid attestation statement format&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AttestationObject</span>  <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Fmt</span>                  <span class="kt">string</span> <span class="c1">// &#34;fmt&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">AttestationStatement</span> <span class="nx">AttestationStatement</span> <span class="c1">// &#34;attStmt&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">AuthenticatorData</span>    <span class="p">[]</span><span class="kt">byte</span> <span class="c1">// &#34;authData&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">AttestationStatement</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// see spec
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code class=%s></pre><p>Next is to parse the authenticator data.</p>
<ul>
<li>Bytes 0-31: Relying party ID hash.</li>
<li>Byte 32: Flags:
<ul>
<li>Bit 0 (least significant - rightmost): Use present.</li>
<li>Bit 2: User verified.</li>
<li>Bit 6: Includes credential data.</li>
</ul>
</li>
<li>Bytes 33-36: Signature counter.</li>
<li>Variable bytes: Credential data (binary).</li>
</ul>
<p>The relying party ID is the domain without the protocol or port and the authenticator data includes the SHA-256 hash of it. For localhost, the relying party ID is <code>localhost</code>. Check for the user presence flag and for the user verification flag if you required user verification. The signature counter is incremented each time the credential is used and can be used to detect forged devices. If your application is intended to be used with hardware security tokens, where credentials are bound to the token, you'd want to store the counter with the credential and ensure the counter value is larger than the previous attempt. However, since passkeys are meant to be shared across devices, this can be safely ignored.</p>
<p>Then, extract the credential ID and public key from the credential data.</p>
<ul>
<li>Bytes 0-15: ID of the authenticator.</li>
<li>Bytes 16 and 17: Credential ID length.</li>
<li>Variable bytes: Credential ID.</li>
<li>Variable bytes: COSE public key.</li>
</ul>
<p>The public key is a CBOR-encoded COSE key.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;bytes&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;crypto/sha256&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/binary&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/json&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">authenticatorData</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">37</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid authenticator data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">rpIdHash</span> <span class="o">:=</span> <span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">32</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">expectedRpIdHash</span> <span class="o">:=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nf">Sum256</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;example.com&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">Equal</span><span class="p">(</span><span class="nx">rpIdHash</span><span class="p">,</span> <span class="nx">expectedRpIdHash</span><span class="p">[:])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid relying party ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Check for the &#34;user present&#34; flag.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;user not present&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Check for the &#34;user verified&#34; flag if you need user verification.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">((</span><span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;user not verified&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">((</span><span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;missing credentials&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">authenticatorData</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">55</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid authenticator data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">credentialIdSize</span><span class="o">:=</span> <span class="nx">binary</span><span class="p">.</span><span class="nx">BigEndian</span><span class="p">.</span><span class="nf">Uint16</span><span class="p">(</span><span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">53</span> <span class="p">:</span> <span class="mi">55</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">authenticatorData</span><span class="p">)</span> <span class="p">&lt;</span> <span class="mi">55</span> <span class="o">+</span> <span class="nx">credentialIdSize</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid authenticator data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">credentialId</span> <span class="o">:=</span> <span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">55</span> <span class="p">:</span> <span class="mi">55</span><span class="o">+</span><span class="nx">credentialIdSize</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">coseKey</span> <span class="o">:=</span> <span class="nx">authenticatorData</span><span class="p">[</span><span class="mi">55</span><span class="o">+</span><span class="nx">credentialIdSize</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Parse COSE public key
</span></span></span></code class=%s></pre><p>The structure of the public key will depend on the algorithm used. Below is the public key for ECDSA, which uses (x, y) for public keys. Validate the algorithm and curve.</p>
<pre class="codeblock"><code>{
	1: 2 // EC2 key type
	3: -7 // Algorithm ID for ECDSA P-256 with SHA-256
	-1: 1 // Curve ID for P-256
	-2: 0x00...00 // x coordinate in bit string
	-3: 0x00...00 // y coordinate in bit string
}
</code></pre><p>Next, validate the client data, which is JSON-encoded. The origin is the domain of your application with the protocol and port. The challenge in the client data is base64url encoded with no padding.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;bytes&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;crypto/sha256&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/base64&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;encoding/json&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;errors&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">expectedChallenge</span> <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Verify the challenge and delete it from storage.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">credentialId</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">clientData</span> <span class="nx">ClientData</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Parse JSON
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">clientData</span><span class="p">.</span><span class="nx">Type</span> <span class="o">!=</span> <span class="s">&#34;webauthn.create&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid type&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">!</span><span class="nf">verifyChallenge</span><span class="p">(</span><span class="nx">clientData</span><span class="p">.</span><span class="nx">Challenge</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid challenge&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">clientData</span><span class="p">.</span><span class="nx">Origin</span> <span class="o">!=</span> <span class="s">&#34;https://example.com&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid origin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ClientData</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Type</span>	  <span class="kt">string</span> <span class="c1">// &#34;type&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Challenge</span> <span class="kt">string</span> <span class="c1">// &#34;challenge&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Origin</span>	  <span class="kt">string</span> <span class="c1">// &#34;origin&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code class=%s></pre><p>Finally, create a new user with their public key and the credential ID. We recommend converting the COSE-encoded public key into one of the more compact and standard formats (<a href="cryptography/ecdsa.html#public-keys">ECDSA</a>).</p>
<h2 id="authentication">Authentication</h2>
<p>During the authentication step, the authenticator creates a new signature using the private key.</p>
<p>Generate a challenge on the server and authenticate the user.</p>
<pre class="codeblock"><code class="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="kr">get</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">challenge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">userVerification</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">credential</span> <span class="k">instanceof</span> <span class="nx">PublicKeyCredential</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;Failed to create credential&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">credential</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">response</span> <span class="k">instanceof</span> <span class="nx">AuthenticatorAssertionResponse</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;Unexpected&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">clientDataJSON</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">clientDataJSON</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">authenticatorData</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">authenticatorData</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">signature</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">signature</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credentialId</span>: <span class="kt">ArrayBuffer</span> <span class="o">=</span> <span class="nx">publicKeyCredential</span><span class="p">.</span><span class="nx">rawId</span><span class="p">;</span>
</span></span></code class=%s></pre><p>For implementing 2FA with security tokens, pass a list of the user's credentials to <code>allowCredentials</code> to support non-resident keys.</p>
<pre class="codeblock"><code class="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">credential</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">credentials</span><span class="p">.</span><span class="kr">get</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">	<span class="nx">publicKey</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">challenge</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">userVerification</span><span class="o">:</span> <span class="s2">&#34;required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// list of user credentials
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="nx">allowCredentials</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="nx">id</span>: <span class="kt">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="kr">type</span><span class="o">:</span> <span class="s2">&#34;public-key&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="p">},</span>
</span></span><span class="line"><span class="cl">		<span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code class=%s></pre><p>The client data, authenticator data, signature, and credential ID are sent to the server. The challenge, the authenticator, and the client data are first verified. This part is nearly identical to the steps for verifying attestation expect that the client data type should be <code>webauthn.get</code>.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="k">if</span> <span class="nx">clientData</span><span class="p">.</span><span class="nx">Type</span> <span class="o">!=</span> <span class="s">&#34;webauthn.get&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;invalid type&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code class=%s></pre><p>Another difference is that the credential portion of the authenticator is not included.</p>
<p>Use the credential ID to get the credential's public key. <strong>For 2FA, ensure that the credential belongs to the authenticated user.</strong> Skipping this check will allow malicious actors to entirely skip 2FA. The signature is of the authenticator data and the SHA-256 hash of the client data JSON. For ECDSA, the signature is <a href="cryptography/ecdsa.html#pkix">ASN.1 DER encoded</a>.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;crypto/ecdsa&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;crypto/sha256&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">clientDataJSONHash</span> <span class="o">:=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nf">Sum256</span><span class="p">(</span><span class="nx">clientDataJSON</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// Concatenate the authenticator data with the hashed client data JSON.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">data</span> <span class="o">:=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">authenticatorData</span><span class="p">,</span> <span class="nx">clientDataJSONHash</span><span class="p">[:]</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nf">Sum256</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">validSignature</span> <span class="o">:=</span> <span class="nx">ecdsa</span><span class="p">.</span><span class="nf">VerifyASN1</span><span class="p">(</span><span class="nx">publicKey</span><span class="p">,</span> <span class="nx">hash</span><span class="p">[:],</span> <span class="nx">signature</span><span class="p">)</span>
</span></span></code class=%s></pre></main>
    </div>
  </div>
</body>


<!-- Mirrored from thecopenhagenbook.com/webauthn by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:51 GMT -->
</html>

<script>
  document
    .getElementById("toggle-mobile-menu-button")
    .addEventListener("click", (e) => {
      const mobileMenuNav = document.getElementById("mobile-menu-nav");
      if (mobileMenuNav.classList.contains("hidden")) {
        mobileMenuNav.classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.add("hidden");
      } else {
        mobileMenuNav.classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.remove("hidden");
      }
    });
</script>