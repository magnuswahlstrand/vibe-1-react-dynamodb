<html lang="en">


<!-- Mirrored from thecopenhagenbook.com/password-authentication by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content="custom" />
  <title>Password authentication</title>
  <meta name="description" content="A basic guideline on implementing auth for the web." />

  <meta name="twitter:card" content="summary" />
  
  <meta name="twitter:site" content="@pilcrowonpaper" />
  
  <meta name="twitter:title" content="Password authentication" />
  <meta name="twitter:description" content="A basic guideline on implementing auth for the web." />

  <meta property="og:site_name" content="The Copenhagen Book" />
  <meta property="og:title" content="Password authentication" />
  <meta property="og:url" content="password-authentication.html" />
  <meta property="og:description" content="A basic guideline on implementing auth for the web." />
  

  

  
  <link rel="stylesheet" href="javascript.css" />
  
  <link rel="stylesheet" href="json.css" />
  
  <link rel="stylesheet" href="main.css" />
  
  <link rel="stylesheet" href="markdown.css" />
  
  <link rel="stylesheet" href="typescript.css" />
  
</head>

<body>
  <div id="mobile-top">
    <div id="mobile-top-container">
      <header id="mobile-header">
        
        <a href="index.html" id="mobile-header-title">The Copenhagen Book</a>
        
        <button id="toggle-mobile-menu-button" class="h-8 w-8 rounded p-2 lg:hidden" aria-label="Toggle menu">
          <svg id="toggle-mobile-menu-button-menu-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 17 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
          <svg id="toggle-mobile-menu-button-close-icon" class="hidden" aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6">
            </path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
        </button>
      </header>
      <nav id="mobile-menu-nav" class="hidden">
        
        <section>
          <h2 class="nav-section-title">Guides</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="sessions.html" class="nav-section-link">Sessions</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-authentication.html" class="current-nav-section-link">Password authentication</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="email-verification.html" class="nav-section-link">Email verification</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-reset.html" class="nav-section-link">Password reset</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="random-values.html" class="nav-section-link">Generating random values</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="oauth.html" class="nav-section-link">OAuth</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="webauthn.html" class="nav-section-link">WebAuthn</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Cryptography</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Links</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
              
            </li>
            
          </ul>
        </section>
        
      </nav>
    </div>
  </div>
  <div id="content">
    <div id="content-container">
      <aside id="sidebar">
        
        <a href="index.html" id="sidebar-title">The Copenhagen Book</a>
        
        <nav id="sidebar-nav">
          
          <section>
            <h2 class="nav-section-title">Guides</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="sessions.html" class="nav-section-link">Sessions</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-authentication.html" class="current-nav-section-link">Password authentication</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="email-verification.html" class="nav-section-link">Email verification</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-reset.html" class="nav-section-link">Password reset</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="random-values.html" class="nav-section-link">Generating random values</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="oauth.html" class="nav-section-link">OAuth</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="webauthn.html" class="nav-section-link">WebAuthn</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Cryptography</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Links</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
                
              </li>
              
            </ul>
          </section>
          
        </nav>
      </aside>
      <main><h1 id="password-authentication">Password authentication</h1>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#input-validation">Input validation</a>
<ul>
<li><a href="#checking-for-compromised-passwords">Checking for compromised passwords</a></li>
</ul>
</li>
<li><a href="#password-storage">Password storage</a>
<ul>
<li><a href="#argon2id">Argon2id</a></li>
<li><a href="#scrypt">Scrypt</a></li>
<li><a href="#bcrypt">Bcrypt</a></li>
</ul>
</li>
<li><a href="#brute-force-attacks">Brute-force attacks</a></li>
<li><a href="#error-handling">Error handling</a></li>
<li><a href="#other-considerations">Other considerations</a></li>
</ul>
<h2 id="input-validation">Input validation</h2>
<ul>
<li>Passwords must be at least 8 characters long.</li>
<li>Do not set the maximum password length too low. Anywhere around 64-256 characters is a good maximum.</li>
<li>Do not silently modify or truncate the input.</li>
<li>All valid Unicode characters should be allowed, including whitespace.</li>
<li>Use libraries like <a href="https://github.com/dropbox/zxcvbn"><code>zxcvbn</code></a> to check for weak passwords.</li>
<li>Detect leaked passwords with APIs such as <a href="https://haveibeenpwned.com/API/v3">haveibeenpwned</a>.</li>
</ul>
<h3 id="checking-for-compromised-passwords">Checking for compromised passwords</h3>
<p>A free service called <a href="https://haveibeenpwned.com/API/v3">haveibeenpwned</a> can be used to check a password against past leaks. Hash the password with SHA-1 (hex-encoded) and send the first 5 characters.</p>
<pre class="codeblock"><code>GET https://api.pwnedpasswords.com/range/12345
</code></pre><p>The API will provide a list of hashed password suffixes beginning with the provided 5 characters</p>
<pre class="codeblock"><code>ec68dea7966a1ea2ba9408be4dcc409884f
248b2dddf14a111b9d08b906d06224a0a79
f10a49ecd2ada17a120dc359f162b84e12c
</code></pre><h2 id="password-storage">Password storage</h2>
<p>Passwords must be salted and hashed before storage. We recommend using <a href="#argon2id">Argon2id</a> with salting.</p>
<p>In the most basic form, hashing is a one-way process to generate a unique representation of the input. The same input should result in the same hash. Unlike encryption, it is not reversible - you can't get the original data from the hash. Popular examples include MD5, SHA-1, and SHA-256 - <strong>DO NOT USE THESE FOR PASSWORDS</strong>.</p>
<p>Hashing ensures that if you suffer a data breach, hackers won't be able to get the original password. This is especially important if the breach is limited in scope. Even if they were only able to read the user table, they'll effectively have access to everything once they get hold of user passwords. More importantly, however, it protects your users from further harm. Users often reuse passwords. With leaked passwords, hackers can gain access to user accounts in other applications as well.</p>
<p>However, a big issue with passwords is that they aren't truly random. Technically there are 62^8 possible 8-character alphanumeric passwords, but the reality is that most passwords use common words and names, maybe with some numbers at the end. This significantly reduces the number of combinations to test when brute-forcing passwords.</p>
<p>As such, slow hashing algorithms specifically designed for passwords are used. Common hashing algorithms like SHA-256 are designed to be as fast as possible.</p>
<p>Even when using a slow algorithm, a table of precomputed hashes of common passwords called a rainbow table can be used. Salting is a common technique to prevent these attacks by adding random values to each password before hashing. The salt must be generated using a cryptographically-secure random generator and it should have at least 120 bits of entropy.</p>
<pre class="codeblock"><code>salt = randomValues()
hash = hashPassword(password + salt) + salt
</code></pre><p>Another option is peppering where you use a secret key when hashing the password. Whereas salts are stored alongside the hashes, the secret key is stored in a separate location. Rolling your own hashing mechanism can be a bad idea so this should only be done if the algorithm you use supports it.</p>
<p>When comparing password hashes, use constant time comparison instead of <code>==</code>. This ensures your application is not vulnerable to timing-based attacks, where an attacker can extract information using how long it took to compare the password with the hash.</p>
<pre class="codeblock"><code class="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;crypto/subtle&#34;</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;golang.org/x/crypto/argon2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">storedHash</span> <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">password</span> <span class="p">[]</span><span class="kt">byte</span>
</span></span><span class="line"><span class="cl"><span class="nx">hash</span> <span class="o">:=</span> <span class="nx">argon2</span><span class="p">.</span><span class="nf">IDKey</span><span class="p">(</span><span class="nx">password</span><span class="p">,</span> <span class="nx">salt</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">19</span><span class="o">*</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">subtle</span><span class="p">.</span><span class="nf">ConstantTimeCompare</span><span class="p">(</span><span class="nx">hash</span><span class="p">,</span> <span class="nx">storedHash</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Valid password.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code class=%s></pre><p>Argon2id should be your first choice, followed by Scrypt, and then Bcrypt for legacy systems.</p>
<p>Password hashing is resource-intensive and is vulnerable to denial-of-service (DoS) attacks.</p>
<h3 id="argon2id">Argon2id</h3>
<p>Argon2 was the winner of the 2013 Password Hashing Competition and has 3 versions: Argon2i, Argon2d, and Argon2id. Argon2id should be your default option as it provides a good balance between resisting both side-channel and GPU-based attacks. Recommended minimum parameters:</p>
<ul>
<li><code>memorySize</code>: 19456 (19 MB)</li>
<li><code>iterations</code>: 2</li>
<li><code>parallelism</code>: 1</li>
</ul>
<p>Optionally use the <code>secret</code> parameter to pepper your hashes. <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#argon2id">See OWASP for details</a>.</p>
<h3 id="scrypt">Scrypt</h3>
<p>Recommended minimum parameters:</p>
<ul>
<li><code>N</code>: 16384</li>
<li><code>r</code>: 16</li>
<li><code>p</code>: 1</li>
<li><code>dkLen</code>: 64</li>
</ul>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#scrypt">See OWASP for details</a>.</p>
<h3 id="bcrypt">Bcrypt</h3>
<p>The work factor should be at minimum a 10.</p>
<p>Bcrypt has a maximum input length of 72 bytes, and some implementations may have a limit as low as 50 bytes. Pre-hashing the password with algorithms like SHA-256/512 is not recommended as some implementations of Bcrypt are not built to handle null bytes. Do not attempt to implement peppering by using HMAC either. Use algorithms like <a href="#argon2id">Argon2id</a> or <a href="#scrypt">Scrypt</a> instead if you need to support longer passwords.</p>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#bcrypt">See OWASP for details</a>.</p>
<h2 id="brute-force-attacks">Brute-force attacks</h2>
<p>Passwords are susceptible to brute-force attacks. There are mainly 2 approaches to brute-forcing:</p>
<ol>
<li>The attacker tries a bunch of common passwords.</li>
<li>The attacker targets specific accounts using leaked passwords (credential stuffing).</li>
</ol>
<p><a href="mfa.html">Multi-factor authentication (MFA)</a> is the best defense against brute-force attacks. While it doesn't prevent brute-force attacks themselves, it does make it nearly pointless to do. Users should be recommended to enable MFA and it should be required for security-critical applications.</p>
<p>IP-based throttling should always be implemented. A basic example is to block all attempts from an IP address for 10 minutes after they fail 10 consecutive attempts. Other ideas include increasing the lockout period on each lockout and gradually allowing new attempts at a set interval after a lockout. This also prevents DOS attacks as password hashing is resource-intensive. An identifier-based throttling can also be implemented on top of IP-based throttling, though this can introduce DoS vulnerabilities (see <a href="https://owasp.org/www-community/Slow_Down_Online_Guessing_Attacks_with_Device_Cookies">device cookies</a>).</p>
<p>Another layer of security you can implement is bot detection using tests like Captchas.</p>
<p>Finally, ensure a certain strength of passwords for users. Make sure passwords aren't weak and that they haven't been part of previous leaks. See the <a href="#password-validation">Password validation</a> section.</p>
<h2 id="error-handling">Error handling</h2>
<p>As a good rule of thumb, error messages should be vague and generic. For example, a login form should display &quot;Incorrect username or password&quot; instead of &quot;Incorrect username&quot; or &quot;Incorrect password.&quot; Similarly, a sign-in form shouldn't share whether a email is already used by an existing account.</p>
<p>However, from a user-experience perspective, it's more user-friendly to tell the user directly that their username or email is incorrect. This should be fine for websites where usernames are already public (e.g. social media) or where knowing the validity of a email isn't important (i.e. most sites). This makes brute-force attacks slightly easier since attackers only need to guess passwords, but you should already have <a href="#brute-force-attacks">proper measures</a> implemented.</p>
<p>If you need to keep the username or email private, make sure you do not leak such information via registration forms and password reset forms. For example, when creating an account, you can prompt the user with a message like &quot;We've sent an email to your inbox with further instructions&quot; regardless of whether the email is taken. If they already have an account, you can include that information in the email itself. Even when returning a generic message however, it may be possible to determine if a user exists or not by checking the response times. For example, if you only validate the password when the username is valid. Protecting against timing-attacks is hard so only go this route if strictly required.</p>
<h2 id="other-considerations">Other considerations</h2>
<ul>
<li>Do not prevent users from copy-pasting passwords as it discourages users from using password managers.</li>
<li>Do not require users to change passwords periodically.</li>
<li>Ask for the current password when a user attempts to change their password.</li>
<li><a href="open-redirect.html">Open redirect</a>.</li>
</ul>
</main>
    </div>
  </div>
</body>


<!-- Mirrored from thecopenhagenbook.com/password-authentication by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:49 GMT -->
</html>

<script>
  document
    .getElementById("toggle-mobile-menu-button")
    .addEventListener("click", (e) => {
      const mobileMenuNav = document.getElementById("mobile-menu-nav");
      if (mobileMenuNav.classList.contains("hidden")) {
        mobileMenuNav.classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.add("hidden");
      } else {
        mobileMenuNav.classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.remove("hidden");
      }
    });
</script>