<html lang="en">


<!-- Mirrored from thecopenhagenbook.com/email-verification by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <meta name="generator" content="custom" />
  <title>Email verification</title>
  <meta name="description" content="A basic guideline on implementing auth for the web." />

  <meta name="twitter:card" content="summary" />
  
  <meta name="twitter:site" content="@pilcrowonpaper" />
  
  <meta name="twitter:title" content="Email verification" />
  <meta name="twitter:description" content="A basic guideline on implementing auth for the web." />

  <meta property="og:site_name" content="The Copenhagen Book" />
  <meta property="og:title" content="Email verification" />
  <meta property="og:url" content="email-verification.html" />
  <meta property="og:description" content="A basic guideline on implementing auth for the web." />
  

  

  
  <link rel="stylesheet" href="javascript.css" />
  
  <link rel="stylesheet" href="json.css" />
  
  <link rel="stylesheet" href="main.css" />
  
  <link rel="stylesheet" href="markdown.css" />
  
  <link rel="stylesheet" href="typescript.css" />
  
</head>

<body>
  <div id="mobile-top">
    <div id="mobile-top-container">
      <header id="mobile-header">
        
        <a href="index.html" id="mobile-header-title">The Copenhagen Book</a>
        
        <button id="toggle-mobile-menu-button" class="h-8 w-8 rounded p-2 lg:hidden" aria-label="Toggle menu">
          <svg id="toggle-mobile-menu-button-menu-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
            fill="none" viewBox="0 0 17 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"></path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
          <svg id="toggle-mobile-menu-button-close-icon" class="hidden" aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6">
            </path>
            <style type="text/css">
              path {
                stroke: #2c2c2c;
              }

              @media (prefers-color-scheme: dark) {
                path {
                  stroke: rgb(191, 191, 191);
                }
              }
            </style>
          </svg>
        </button>
      </header>
      <nav id="mobile-menu-nav" class="hidden">
        
        <section>
          <h2 class="nav-section-title">Guides</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="sessions.html" class="nav-section-link">Sessions</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-authentication.html" class="nav-section-link">Password authentication</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="email-verification.html" class="current-nav-section-link">Email verification</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="password-reset.html" class="nav-section-link">Password reset</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="random-values.html" class="nav-section-link">Generating random values</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="oauth.html" class="nav-section-link">OAuth</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="webauthn.html" class="nav-section-link">WebAuthn</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Cryptography</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
              
            </li>
            
          </ul>
        </section>
        
        <section>
          <h2 class="nav-section-title">Links</h2>
          <ul class="nav-section-links-list">
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
              
            </li>
            
            <li class="nav-section-links-list-item">
              
              <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
              
            </li>
            
          </ul>
        </section>
        
      </nav>
    </div>
  </div>
  <div id="content">
    <div id="content-container">
      <aside id="sidebar">
        
        <a href="index.html" id="sidebar-title">The Copenhagen Book</a>
        
        <nav id="sidebar-nav">
          
          <section>
            <h2 class="nav-section-title">Guides</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="server-side-tokens.html" class="nav-section-link">Server-side tokens</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="sessions.html" class="nav-section-link">Sessions</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-authentication.html" class="nav-section-link">Password authentication</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="email-verification.html" class="current-nav-section-link">Email verification</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="password-reset.html" class="nav-section-link">Password reset</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="random-values.html" class="nav-section-link">Generating random values</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="oauth.html" class="nav-section-link">OAuth</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="mfa.html" class="nav-section-link">Multi-factor authentication (MFA)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="webauthn.html" class="nav-section-link">WebAuthn</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="csrf.html" class="nav-section-link">Cross-site request forgery (CSRF)</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="open-redirect.html" class="nav-section-link">Open redirect</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Cryptography</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="cryptography/ecdsa.html" class="nav-section-link">ECDSA</a>
                
              </li>
              
            </ul>
          </section>
          
          <section>
            <h2 class="nav-section-title">Links</h2>
            <ul class="nav-section-links-list">
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/pilcrowonpaper/copenhagen" class="nav-section-link">GitHub repository</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://twitter.com/pilcrowonpaper" class="nav-section-link">Twitter</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://cheatsheetseries.owasp.org/" class="nav-section-link">OWASP Cheat Sheet Series</a>
                
              </li>
              
              <li class="nav-section-links-list-item">
                
                <a href="https://github.com/sponsors/pilcrowOnPaper" class="nav-section-link">Donate</a>
                
              </li>
              
            </ul>
          </section>
          
        </nav>
      </aside>
      <main><h1 id="email-verification">Email verification</h1>
<p>If your application requires user email addresses to be unique, email verification is a must. It discourages users from entering a random email address and, if password reset is implemented, allows users to take back accounts created with their email address. You may even want to block users from accessing your application's content until they verify their email address.</p>
<p><em>Email addresses are case-insensitive.</em> We recommend normalizing user-provided email addresses to lower case.</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#input-validation">Input validation</a>
<ul>
<li><a href="#sub-addressing">Sub-addressing</a></li>
</ul>
</li>
<li><a href="#email-verification-codes">Email verification codes</a></li>
<li><a href="#email-verification-links">Email verification links</a></li>
<li><a href="#changing-emails">Changing emails</a></li>
<li><a href="#rate-limiting">Rate limiting</a></li>
</ul>
<h2 id="input-validation">Input validation</h2>
<p>Emails are complex and cannot be fully validated using Regex. Attempting to use Regex may also introduce <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">ReDoS vulnerabilities</a>. Do not over-complicate it:</p>
<ul>
<li>Includes at least 1 <code>@</code> character.</li>
<li>Has at least 1 character before the<code>@</code>.</li>
<li>The domain part includes at least 1 <code>.</code> and has at least 1 character before it.</li>
<li>It does not start or end with a whitespace.</li>
<li>Maximum of 255 characters.</li>
</ul>
<h3 id="sub-addressing">Sub-addressing</h3>
<p>Some email providers, including Google, allow users to specify a tag that will be ignored by their servers. For example, a user with <code><a href="cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="6015130512200518010d100c054e030f0d">[email&#160;protected]</a></code> can use <code><a href="cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="9de8eef8efb6fbf2f2ddf8e5fcf0edf1f8b3fef2f0">[email&#160;protected]</a></code> and <code><a href="cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="37424452451c55564577524f565a475b521954585a">[email&#160;protected]</a></code>. You can block emails with <code>+</code> to prevent users from making multiple accounts with the same email address, but users would still be able to use temporary email addresses or just create a new email address. Never silently remove the tag portion from the user input as an email address with <code>+</code> can just be a regular, valid email address.</p>
<h2 id="email-verification-codes">Email verification codes</h2>
<p>One way to verify email is to send a secret code stored in the server to the user's mailbox.</p>
<p>This approach has some advantages over using links:</p>
<ul>
<li>People are increasingly less likely to click on links.</li>
<li>Some filters may automatically classify emails with links as spam or phishing.</li>
<li>Using verification links may introduce friction if the user wants to finish the process on a device that does not have access to the verification message, or on a device that cannot open links.</li>
</ul>
<p>The verification code should be at least 8 digits if the code is numeric, and at least 6 digits if it's alphanumeric. Use a stronger code if the verification is part of a secure process, like creating a new account or changing contact information. You should avoid using both lowercase and uppercase letters. You may also want to remove numbers and letters that can be misread (0, O, 1, I, etc). It must be generated using a cryptographically secure random generator.</p>
<p>A single verification code should be tied to a single user and email. This is especially important if you allow users to change their email address after they're sent an email. Each code should be valid for at least 15 minutes (anywhere between 1-24 hours is recommended). The code must be single-use and immediately invalidated after validation. A new verification code should be generated every time the user asks for another email/code.</p>
<p>Similar to a regular login form, throttling or rate-limiting based on the user ID must be implemented. A good limit is around 10 attempts per hour. Assuming proper limiting is implemented, the code can be valid for up to 24 hours. You should generate and resend a new code if the user-provided code has expired.</p>
<p>All sessions of a user should be invalidated when their email is verified.</p>
<h2 id="email-verification-links">Email verification links</h2>
<p>An alternative way to verify emails is to use a verification link that contains a long, random, single-use <a href="server-side-tokens.html">token</a>.</p>
<pre class="codeblock"><code>https://example.com/verify-email/&lt;TOKEN&gt;
</code></pre><p>A single token should be tied to a single user and email. This is especially important if you allow users to change their email address after they're sent an email. Tokens should be single-use and be immediately deleted from storage after verification. The token should be valid for at least 15 minutes (anywhere between 1-24 hours is recommended). When a user asks for another verification email, you can resend the previous token instead of generating a new token if that token is still within expiration.</p>
<p>Make sure to set the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy">Referrer Policy</a> tag to <code>strict-origin</code> (or equivalent) for any path that includes tokens to protect the tokens from referer leakage.</p>
<p>All sessions should be invalidated when the email is verified (and create a new one for the current user so they stay signed in).</p>
<h2 id="changing-emails">Changing emails</h2>
<p>The user should be asked for their password, or if <a href="mfa.html">multi-factor authentication</a> is enabled, authenticated with one of their second factors. The new email should be stored separately from the current email until it's verified. For example, the new email could be stored with the verification token/code.</p>
<p>A notification should be sent to the previous email address when the user changes their email.</p>
<h2 id="rate-limiting">Rate limiting</h2>
<p>Any endpoint that can send emails should have strict rate limiting implemented.</p>
</main>
    </div>
  </div>
<script data-cfasync="false" src="cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>


<!-- Mirrored from thecopenhagenbook.com/email-verification by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 20 Apr 2025 12:02:51 GMT -->
</html>

<script>
  document
    .getElementById("toggle-mobile-menu-button")
    .addEventListener("click", (e) => {
      const mobileMenuNav = document.getElementById("mobile-menu-nav");
      if (mobileMenuNav.classList.contains("hidden")) {
        mobileMenuNav.classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.remove("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.add("hidden");
      } else {
        mobileMenuNav.classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-close-icon")
          .classList.add("hidden");
        document
          .getElementById("toggle-mobile-menu-button-menu-icon")
          .classList.remove("hidden");
      }
    });
</script>